<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-165829341-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

<title data-react-helmet="true">Testing in Node | Code Quality</title>

<meta data-react-helmet="true" property="og:title" content="Testing in Node | Code Quality"><meta data-react-helmet="true" name="description" content="Recommendations and best practices for testing in Node (and general sw testing)"><meta data-react-helmet="true" property="og:description" content="Recommendations and best practices for testing in Node (and general sw testing)"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image">

<link data-react-helmet="true" rel="shortcut icon" href="/docs-and-blog/img/website-icon.png">


<link rel="stylesheet" href="/docs-and-blog/styles.cb408154.css">


<link rel="preload" href="/docs-and-blog/styles.463d0a4b.js" as="script">

<link rel="preload" href="/docs-and-blog/runtime~main.45e8d13d.js" as="script">

<link rel="preload" href="/docs-and-blog/main.f2733a76.js" as="script">

<link rel="preload" href="/docs-and-blog/1.89183380.js" as="script">

<link rel="preload" href="/docs-and-blog/2.7ca4265b.js" as="script">

<link rel="preload" href="/docs-and-blog/3.57a4435b.js" as="script">

<link rel="preload" href="/docs-and-blog/ccc49370.67ed2bb1.js" as="script">

<link rel="preload" href="/docs-and-blog/09e5afdc.abf35e2b.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/docs-and-blog/"><img class="navbar__logo" src="/docs-and-blog/img/website-icon.png" alt="Code Quality Logo"><strong class="navbar__title">Code Quality</strong></a><a class="navbar__item navbar__link" href="/docs-and-blog/docs/node/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs-and-blog/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/code-quality-metrics" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs-and-blog/"><img class="navbar__logo" src="/docs-and-blog/img/website-icon.png" alt="Code Quality Logo"><strong class="navbar__title">Code Quality</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs-and-blog/docs/node/intro">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" position="left" href="/docs-and-blog/blog">Blog</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/code-quality-metrics" class="menu__link" position="right">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_2RZH">Testing in Node</h1><div class="margin-vert--md"><time datetime="2020-04-25T00:00:00.000Z" class="blogPostDate_3tRe">April 25, 2020  · 3 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/DavidOVM" target="_blank" rel="noreferrer noopener"><img src="https://avatars2.githubusercontent.com/u/15112119?s=460&amp;u=87d77526d3584da629e60e6cf8c5f65b0f9749c7&amp;v=4" alt="David Ortiz"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/DavidOVM" target="_blank" rel="noreferrer noopener">David Ortiz</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>Recommendations and best practices for testing in Node (and general sw testing)</p><p>For any type of test (unit, acceptance, integration...) and for any implementation or tool of said test, there are certain rules it should follow.</p><p>Provide easy tracking of what is being tested. When naming a test make sure it includes what&#x27;s being tested, under which circumstances and what&#x27;s the expected behaviour. This will provide better understanding of what the test should do.</p><p>When implementing the test, follow the Given - When - Then pattern. Preconditions, action and result. Set up the conditions for the test, default values, mocks and such. Then execute the action, should be just one. Finally, assert the results.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-gherkin codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Feature: User model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Scenario: Create already created user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Given a user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    When the same user is created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Then there is an error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    And the user is not created twice</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Keep tests independent</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">beforeEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">done</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token maybe-class-name">User</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">collection</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">drop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">done</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// descriptive names</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">describe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;User model&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Should not create user when when already created&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Given</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// mimic real values (name)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> user1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">User</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Mike&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// When</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> user2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">User</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Mike&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">expect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toBeNull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * User model - Should create user when valid name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * User model - Should not create user when invalid name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * User model - Should not create user when already created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * /</span></div></div></div></div></div><p>Keep language easy and understandable by non-engineering profiles (even more important for acceptance tests). For this try to keep the code clean. If testing an error, don&#x27;t add try catch, use something like <code>expect(method).to.throw</code> to make it easier to read.</p><p>It&#x27;s also important to define what needs to be tested. Sometimes it&#x27;s better to start from the outside and test the system as a blackbox and then go deeper into the implementation.</p><p>Any test should mimic the real execution as much as possible. That&#x27;s why when testing features that use external services it&#x27;s better to stub or spy than to mock. Spies are clearer and closer to the real behaviour of the system. Also when providing values for tests try to keep them as close to reality as possible (e.g. real names, addresses etc).</p><p>Tests should be independent (as much as possible). Don&#x27;t seed the db globaly before testing. Drop everything from there and have each test add whatever is necessary for it.</p><p><a href="https://www.npmjs.com/package/sinon">https://www.npmjs.com/package/sinon</a>
<a href="https://www.npmjs.com/package/node-mocks-http">https://www.npmjs.com/package/node-mocks-http</a>
<a href="https://github.com/goldbergyoni/node-chaos-monkey">https://github.com/goldbergyoni/node-chaos-monkey</a></p><p>Aim for a 80% test coverage. Anything over that could be too expensive and won&#x27;t provide more confidence.</p><blockquote><p>I would be suspicious of anything like 100% - it would smell of someone writing tests to make the coverage numbers happy, but not thinking about what they are doing.
<a href="https://martinfowler.com/bliki/TestCoverage.html">https://martinfowler.com/bliki/TestCoverage.html</a></p></blockquote><p>Don&#x27;t forget linting. This could prevent many errors and it&#x27;s fast to implement and run. Should be the first step.</p><p><a href="https://github.com/goldbergyoni/javascript-testing-best-practices">https://github.com/goldbergyoni/javascript-testing-best-practices</a></p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/docs-and-blog/blog/tags/node">node</a><a class="margin-horiz--sm" href="/docs-and-blog/blog/tags/testing">testing</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-and-blog/blog/modularDesign"><div class="pagination-nav__link--sublabel">Previous Post</div><div class="pagination-nav__link--label">« Modular design</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Blog posts</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs-and-blog/blog/tags/node">Node</a></li><li class="footer__item"><a class="footer__link-item" href="/docs-and-blog/blog/tags/react">React</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://code-quality-metrics.github.io" href="https://code-quality-metrics.github.io">Main Page</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/code-quality-metrics">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 CQ. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/docs-and-blog/styles.463d0a4b.js"></script>

<script src="/docs-and-blog/runtime~main.45e8d13d.js"></script>

<script src="/docs-and-blog/main.f2733a76.js"></script>

<script src="/docs-and-blog/1.89183380.js"></script>

<script src="/docs-and-blog/2.7ca4265b.js"></script>

<script src="/docs-and-blog/3.57a4435b.js"></script>

<script src="/docs-and-blog/ccc49370.67ed2bb1.js"></script>

<script src="/docs-and-blog/09e5afdc.abf35e2b.js"></script>


</body>
</html>