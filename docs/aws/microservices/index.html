<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-165829341-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

<title data-react-helmet="true">Microservices and networking | Code Quality</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Microservices and networking | Code Quality"><meta data-react-helmet="true" name="description" content="Microservices and modularity within your system."><meta data-react-helmet="true" property="og:description" content="Microservices and modularity within your system."><meta data-react-helmet="true" property="og:url" content="https://code-quality-metrics.github.io/docs-and-blog//docs-and-blog/docs/aws/microservices">

<link data-react-helmet="true" rel="shortcut icon" href="/docs-and-blog/img/website-icon.png">


<link rel="stylesheet" href="/docs-and-blog/styles.cb408154.css">


<link rel="preload" href="/docs-and-blog/styles.85895549.js" as="script">

<link rel="preload" href="/docs-and-blog/runtime~main.6ce416f7.js" as="script">

<link rel="preload" href="/docs-and-blog/main.3f18cb6a.js" as="script">

<link rel="preload" href="/docs-and-blog/1.a8e8533e.js" as="script">

<link rel="preload" href="/docs-and-blog/2.50c86778.js" as="script">

<link rel="preload" href="/docs-and-blog/3.58bf734d.js" as="script">

<link rel="preload" href="/docs-and-blog/1be78505.77edad06.js" as="script">

<link rel="preload" href="/docs-and-blog/30c6e889.5fdb2913.js" as="script">

<link rel="preload" href="/docs-and-blog/17896441.7924a4fd.js" as="script">

<link rel="preload" href="/docs-and-blog/ee069ef6.c527cc39.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/docs-and-blog/"><img class="navbar__logo" src="/docs-and-blog/img/website-icon.png" alt="Code Quality Logo"><strong class="navbar__title">Code Quality</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs-and-blog/docs/node/intro">Docs</a><a class="navbar__item navbar__link" href="/docs-and-blog/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/code-quality-metrics" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs-and-blog/"><img class="navbar__logo" src="/docs-and-blog/img/website-icon.png" alt="Code Quality Logo"><strong class="navbar__title">Code Quality</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" position="left" href="/docs-and-blog/docs/node/intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs-and-blog/blog">Blog</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/code-quality-metrics" class="menu__link" position="right">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Node JS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/web-server">Basics of a web server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/require">Require and modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/events">Events and inheritance</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Advanced node</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/advanced/clusters">Clusters and child processes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/advanced/repl">REPL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/advanced/global-process-buffer">Global, process, buffer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/advanced/streams">Streams</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/advanced/event-loop">The event loop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/advanced/modularity">Modularity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/advanced/net">Net server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/advanced/udp">UDP sockets</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Cryptography</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/cryptography/crypto">The crypto module</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/cryptography/passwords">Passwords</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/cryptography/data-at-rest">Data at rest</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/cryptography/data-in-transit">Data in transit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/node/cryptography/mfa">MFA</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">AWS + Docker</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-and-blog/docs/aws/intro">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" tabindex="0" href="/docs-and-blog/docs/aws/microservices">Microservices and networking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-and-blog/docs/aws/ecs">ECS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Practical examples</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/aws/examples/example1">Building and publishing images</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/aws/examples/example2">Multi container with shared data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-and-blog/docs/aws/examples/example3">Deploying to EB and ECS + seeded volume</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Microservices and networking</h1></header><div class="markdown"><p>Microservices and modularity within your system.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ecs"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ecs" title="Direct link to heading">#</a>ECS</h4><p>ECS is an orchestration tool for EC2. Service for running and managing containers.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="cloudwatch"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#cloudwatch" title="Direct link to heading">#</a>Cloudwatch</h4><p><strong>Cloudwatch</strong> for monitoring.
Container Insights is available for Amazon Elastic Container Service, Amazon Elastic Kubernetes Service, and Kubernetes platforms on Amazon EC2. The metrics include utilization for resources such as CPU, memory, disk, and network. Container Insights also provides diagnostic information, such as container restart failures, to help you isolate issues and resolve them quickly. You can also set CloudWatch alarms on metrics that Container Insights collects.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="fargate"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#fargate" title="Direct link to heading">#</a>Fargate</h4><p><strong>Fargate</strong> reduces the preliminary setup for hosting containers in EC2. Serverless compute engine, allows to host containers in a fully managed commpute platform (no infrastructre set up). ECS still manages the container lifecycle. EC2 is abstracted when using Fargate.</p><p>For fargate we need to configure image, Memory, CPU, network(vpc, subnets, security groups), IAM permissions</p><p>EC2 charges per instance hour or second, with Fargate you pay just for the time the server is up.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="key-concepts"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#key-concepts" title="Direct link to heading">#</a>key concepts</h3><ul><li><p><strong>Cluster</strong>: logical isolation boundary for the infrastructure that hosts the containers. Can expand multiple availability zones. (abstracted in fargate)</p></li><li><p><strong>Task</strong>: wrapper to run a container. Has a task definition (image, tag, memory, CPU, ports, shared volumes). An app can expand multiple task definition.</p></li><li><p><strong>Service</strong>: allows to configure the tasks in the cluster, load balancer, subnet, sec groups...</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="creating-clusters-tasks-and-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#creating-clusters-tasks-and-services" title="Direct link to heading">#</a>Creating Clusters, tasks and services</h3><ul><li><ol><li>Create load balancer for publishing the port 80</li></ol></li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws elbv2 create-load-balancer --name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div></div></div></div></div><ul><li><ol start="2"><li>Target group (where our tasks will run) define the port (8080)</li></ol></li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws elbv2 create-target-group --name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div></div></div></div></div><ul><li><ol start="3"><li>Create a listener. It&#x27;ll listen to http requests in port 80 and route them to the target group in 8080</li></ol></li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws elbv2 create-listener --load-balancer-arn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div></div></div></div></div><ul><li><ol start="4"><li>Create cluster</li></ol></li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ecs create-cluster --cluster-name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div></div></div></div></div><ul><li><ol start="5"><li>Create task definition (needs IAM roles). Take the image from the repository in ECR (the uri) that should be included in the container definition of the task definition.</li></ol></li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ecs register-task-definition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div></div></div></div></div><ul><li><ol start="6"><li>Create a service that uses the task definition to launch a task</li></ol></li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ecs create-service --cluster</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div></div></div></div></div><ul><li><ol start="7"><li>List the services in the cluster</li></ol></li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ecs list-services --cluster</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div></div></div></div></div><ul><li><ol start="8"><li>Grab the DNS of the load balancer in the EC2 management console. That url can be publicly accessed with the website.</li></ol></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="get-traffic-to-tasks"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#get-traffic-to-tasks" title="Direct link to heading">#</a>Get traffic to tasks</h3><p>Through a load balancer. (ALB) Application Load Balancer recommended for HTTP and HTTPs.
Provides Dynamic host port mapping and path based routing (routing requests based on the url /api/user /api/product).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="communicate-with-other-containers"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#communicate-with-other-containers" title="Direct link to heading">#</a>Communicate with other containers</h3><p>Done on the task definition with the Network mode</p><ul><li>None: containers cannot talk to anything and there are no port mappings.</li><li>Bridge: Each task gets an IP and communicates over the Docker bridge. Containers share the network interface fo the host EC2 instance.</li><li>Host: map container ports into the EC2 instance&#x27;s network interface. Does not allow multiple tasks from the same service to be place in the same container instance. No dynamic port mapping</li><li>AWS VPC: every tasks gets the same networking properties as the EC2 instance.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="container-storage"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#container-storage" title="Direct link to heading">#</a>Container storage</h3><p>By default containers do not have persistent storage.
The data needs to be externalize outside the container. For this we have several options:</p><ul><li><strong>Bind mount</strong>: A file or folder stored on the container host filesystem and mounted into a running contianer.</li><li><strong>Volumes</strong>: Stored in the host file system but managed by the container manager. <strong>(Preferred method)</strong></li></ul><p>EBS (Amazon Elastic Block Store) provides EBS volumes tight to availability zones. (need to clone volumes if want to access the same one from multiple containers)</p><p><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-networking.html">https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-networking.html</a>
<a href="https://aws.amazon.com/blogs/mt/introducing-container-insights-for-amazon-ecs/">https://aws.amazon.com/blogs/mt/introducing-container-insights-for-amazon-ecs/</a>
<a href="https://docs.docker.com/storage/volumes/">https://docs.docker.com/storage/volumes/</a>
<a href="https://aws.amazon.com/microservices/">https://aws.amazon.com/microservices/</a></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-and-blog/docs/aws/intro"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-and-blog/docs/aws/ecs"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">ECS »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#key-concepts" class="contents__link">key concepts</a></li><li><a href="#creating-clusters-tasks-and-services" class="contents__link">Creating Clusters, tasks and services</a></li><li><a href="#get-traffic-to-tasks" class="contents__link">Get traffic to tasks</a></li><li><a href="#communicate-with-other-containers" class="contents__link">Communicate with other containers</a></li><li><a href="#container-storage" class="contents__link">Container storage</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Blog posts</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs-and-blog/blog/tags/node">Node</a></li><li class="footer__item"><a class="footer__link-item" href="/docs-and-blog/blog/tags/react">React</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://code-quality-metrics.github.io" href="https://code-quality-metrics.github.io">Main Page</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/code-quality-metrics">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 CQ. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/docs-and-blog/styles.85895549.js"></script>

<script src="/docs-and-blog/runtime~main.6ce416f7.js"></script>

<script src="/docs-and-blog/main.3f18cb6a.js"></script>

<script src="/docs-and-blog/1.a8e8533e.js"></script>

<script src="/docs-and-blog/2.50c86778.js"></script>

<script src="/docs-and-blog/3.58bf734d.js"></script>

<script src="/docs-and-blog/1be78505.77edad06.js"></script>

<script src="/docs-and-blog/30c6e889.5fdb2913.js"></script>

<script src="/docs-and-blog/17896441.7924a4fd.js"></script>

<script src="/docs-and-blog/ee069ef6.c527cc39.js"></script>


</body>
</html>