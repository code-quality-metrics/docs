(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{180:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return i})),n.d(t,"default",(function(){return p}));var a=n(1),r=n(9),s=(n(0),n(190)),c={id:"ecs",title:"ECS",sidebar_label:"ECS"},o={id:"aws/ecs",title:"ECS",description:"Amazon Elastic Container Service: components, task management, deployment, secret handling...",source:"@site/docs/aws/ecs.md",permalink:"/docs-and-blog/docs/aws/ecs",sidebar_label:"ECS",sidebar:"someSidebar",previous:{title:"Microservices and networking",permalink:"/docs-and-blog/docs/aws/microservices"},next:{title:"Building and publishing images",permalink:"/docs-and-blog/docs/aws/examples/example1"}},i=[{value:"Components",id:"components",children:[]},{value:"Scheduling tasks in the cluster",id:"scheduling-tasks-in-the-cluster",children:[]},{value:"How to host containers, example",id:"how-to-host-containers-example",children:[]}],l={rightToc:i};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(s.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,"Amazon Elastic Container Service: components, task management, deployment, secret handling..."),Object(s.b)("p",null,"Container orchestration platforms -> handle spinning up containers, network, permissions, other service integration. ECS is the orchestration platform in AWS."),Object(s.b)("p",null,"ECS has a control plane and a data plane. The control plane is responsible for provisioning software, manage lifecycle of resources, support data plane. And the data plane provides the capacity to complete requests (from the control plane)."),Object(s.b)("p",null,"ECS can work on top of a cluster of EC2 instances or on top of Fargate. The EC2 cluster is the data plane."),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-diagram"}),"User -> ECS API -> EC2 cluster\nUser -> control plane -> data plane\n")),Object(s.b)("h3",{id:"components"},"Components"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"Task definition")," -> json file to describe up to 10 containers"),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"Task")," -> an instance of a task definition inside a cluster"),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"Scheduler")," -> places tasks in a cluster"),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"Cluster")," -> group of compute resources (logical), EC2 or Fargate"),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"Service")," -> run and maintain tasks simultaniosly"),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"Container agent")," -> runs on each compute node of the cluster. Sends info about utilization and the running task, starts and stops tasks.")),Object(s.b)("h3",{id:"scheduling-tasks-in-the-cluster"},"Scheduling tasks in the cluster"),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Scheduling engine")," -> How when and where to start and stop containers. ECS provides differnet schedulers."),Object(s.b)("p",null,"Service Scheduler is one of them, it'll reschedule tasks if they fail maintaing always the configured number of tasks running. It has strategies, like the daemon strategy that allows one task to always run in every instance of the cluster."),Object(s.b)("p",null,"EventBridge has the cron scheduling to run process at certain time."),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Placement engine")," -> decides which instance gets the task. It has strategies and constraints. Constraints allow to filter out instances, for example never run two given tasks together. Strategies determine how to place instances (binpack, spread...)"),Object(s.b)("h3",{id:"how-to-host-containers-example"},"How to host containers, example"),Object(s.b)("p",null,"Given a pushedd image to ECR"),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol"},"create cluster")),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"aws ecs create-cluster ...\n")),Object(s.b)("ol",{start:2},Object(s.b)("li",{parentName:"ol"},"Now that the cluster is created we need to add EC2 instances to it.")),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"aws ec2 run-instances --count 2...\n")),Object(s.b)("ol",{start:3},Object(s.b)("li",{parentName:"ol"},"Now instances are running we can create the task definition")),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"aws ecs register-task-definition ...\n")),Object(s.b)("ol",{start:4},Object(s.b)("li",{parentName:"ol"},"Create a service to run the task in the cluster")),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"aws ecs create-service...\n")),Object(s.b)("p",null,"Now the tasks will be running in the cluster. We can describe the tasks and see which EC2 instance they are running in, take the public DNS name and access it from a browser."),Object(s.b)("p",null," ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=cpqvIEgngcY&list=PLhr1KZpdzukfWFTsOD_WynnY2-e8TY8fH&index=5"}),"https://www.youtube.com/watch?v=cpqvIEgngcY&list=PLhr1KZpdzukfWFTsOD_WynnY2-e8TY8fH&index=5"),"\n",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://aws.amazon.com/ecs/faqs/"}),"https://aws.amazon.com/ecs/faqs/"),"\n",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.aws.amazon.com/AmazonECS/latest/userguide/security_iam_service-with-iam.html"}),"https://docs.aws.amazon.com/AmazonECS/latest/userguide/security_iam_service-with-iam.html"),"\n",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://aws.amazon.com/blogs/aws/aws-fargate-spot-now-generally-available/"}),"https://aws.amazon.com/blogs/aws/aws-fargate-spot-now-generally-available/"),"\n",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/scheduling_tasks.html"}),"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/scheduling_tasks.html"),"\n"))}p.isMDXComponent=!0},190:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return d}));var a=n(0),r=n.n(a);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o({},t,{},e)),n},b=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),b=p(n),m=a,d=b["".concat(c,".").concat(m)]||b[m]||u[m]||s;return n?r.a.createElement(d,o({ref:t},l,{components:n})):r.a.createElement(d,o({ref:t},l))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,c=new Array(s);c[0]=m;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o.mdxType="string"==typeof e?e:a,c[1]=o;for(var l=2;l<s;l++)c[l]=n[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);